{% extends 'layout/base.html' %}

{% block content %}
<div class="flex flex-col gap-5 py-10">
    <turbo-frame id="upload-form">
        <div class="flex flex-row-reverse">
            <form action="/report" method="post" data-turbo-frame="upload-result" enctype="multipart/form-data">
                <label for="upload-button" class="hover:cursor-pointer">
                    <div
                        class="transition relative flex flex-row items-center gap-2 bg-orange-700 hover:bg-orange-700/90 px-3 py-2 border border-orange-700 rounded">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-6 h-6 stroke-white">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                            </svg>
                        </span>
                        <span class="font-semibold text-base text-white">Upload</span>
                    </div>
                    <input id="upload-button" type="file" name="file" class="hidden"
                        onchange="this.form.requestSubmit();" />
                </label>
            </form>
        </div>
    </turbo-frame>
    <turbo-frame id="upload-result" class="flex flex-col gap-5">
        {% if report is not none %}
        <div>
            <h2 class="text-3xl mb-3">Parts:</h2>
            <table class="table-auto w-full border-collapse border border-orange-800">
                <thead class="bg-orange-700 text-white">
                    <tr>
                        <th class="py-1">#</th>
                        <th class="py-1">Part Number</th>
                        <th class="py-1">Part Name</th>
                        <th class="py-1">Color</th>
                        <th class="py-1">Is Spare</th>
                        <th class="py-1">Quantity</th>
                        <th class="py-1">Missing</th>
                    </tr>
                </thead>
                <tbody class="font-semibold text-gray-700">
                    {% for part in report['parts'] %}
                    <tr class="odd:bg-white even:bg-gray-100">
                        <td class="py-1 text-center">{{ loop.index0 }}</td>
                        <td class="py-1 text-center">{{ part['part_num'] }}</td>
                        <td class="py-1">{{ part['part_name'] }}</td>
                        <td class="py-1 flex flex-row items-center"><span class="w-4 h-4 mr-2 rounded-full" style="background-color: #{{ part['color_rgb']  }};"></span>{{ part['color_name'] }}</td>
                        <td class="py-1 text-center">{{ 'Yes' if part['is_spare'] == 't' else 'No' }}</td>
                        <td class="py-1 text-center">{{ part['quantity'] }}</td>
                        <td class="py-1 text-center">{{ part['missing'] }}</td>
                    </tr>
                    {% endfor %}

                    {% if report['parts']|length == 0 %}
                    <tr>
                        <td colspan="7" valign="top" class="text-center py-2">No data available</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div>
            <h2 class="text-3xl mb-3">Minifig Parts</h2>
            <table class="table-auto w-full border-collapse border border-orange-800">
                <thead class="bg-orange-700 text-white">
                    <tr>
                        <th class="py-1">#</th>
                        <th class="py-1">Part Number</th>
                        <th class="py-1">Fig Number</th>
                        <th class="py-1">Part Name</th>
                        <th class="py-1">Color</th>
                        <th class="py-1">Is Spare</th>
                        <th class="py-1">Quantity</th>
                        <th class="py-1">Missing</th>
                    </tr>
                </thead>
                <tbody class="font-semibold text-gray-700">
                    {% for part in report['fig_parts'] %}
                    <tr class="odd:bg-white even:bg-gray-100">
                        <td class="py-1 text-center">{{ loop.index0 }}</td>
                        <td class="py-1 text-center">{{ part['part_num'] }}</td>
                        <td class="py-1 text-center">{{ part['fig_num'] }}</td>
                        <td class="py-1">{{ part['part_name'] }}</td>
                        <td class="py-1 flex flex-row items-center"><span class="w-4 h-4 mr-2 rounded-full" style="background-color: #{{ part['color_rgb']  }};"></span>{{ part['color_name'] }}</td>
                        <td class="py-1 text-center">{{ 'Yes' if part['is_spare'] == 't' else 'No' }}</td>
                        <td class="py-1 text-center">{{ part['quantity'] }}</td>
                        <td class="py-1 text-center">{{ part['missing'] }}</td>
                    </tr>
                    {% endfor %}

                    {% if report['fig_parts']|length == 0 %}
                    <tr>
                        <td colspan="7" valign="top" class="text-center py-2">No data available</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </turbo-frame>
</div>
{% endblock %}